## **키의 경로 체계(Derivation Path)**

- HDWallet은 하나의 시드로부터 무한대에 가까운 키를 파생할 수 있다
- 하지만 ‘많이 만드는 것’보다 ‘어떤 목적의 키를 어떻게 구분해서 만들 것인가’가 더 중요하다
- 이때 사용되는 표준이 BIP44 (Multi-Account Hierarchy for Deterministic Wallets)이다

### BIP44 표준 경로 구조

BIP44에서 모든 키를 아래 규칙에 따라 트리 형태로 관리한다

```swift
m / purpose' / coin_type' / account' / change / address_index

/*
예시 - 동일한 시드에서 코인 타입이나 계정 번호만 바꾸면 각 체인에 맞는 독립된 주소를 생성할 수 있다
비트코인:  m/44'/0'/0'/0/0
이더리움:  m/44'/60'/0'/0/0
바이낸스:  m/44'/714'/0'/0/0
*/
```

| **구분** | **설명** |
| --- | --- |
| **m** | 마스터 키(루트) |
| **purpose’** | 어떤 표준을 따를지 명시 (예: 44는 BIP44, 49는 BIP49, 84는 BIP84) |
| **coin_type’** | 코인 종류 구분 (SLIP-44 표준 번호 사용: BTC=0, ETH=60, BNB=714 등) |
| **account’** | 사용자 계정 단위 (0부터 시작, 여러 계정 구분 가능) |
| **change** | 0 = 외부 주소, 1 = 내부 주소(체인지 주소, 거스름돈을 받는 주소) |
| **address_index** | 개별 주소 인덱스 (0부터 순차 증가) |

### **Account (계정 번호)**

> “이 지갑 안에서 몇 번째 계정인지”
> 
- 여러 개의 독립적인 지갑 세트를 만들 때 사용.
- 예를 들어 하나의 니모닉으로
    - Account 0 → 개인용 지갑
    - Account 1 → 비즈니스용 지갑
    - Account 2 → 테스트 지갑

### **Change (외부/내부 주소)**

> “이 주소가 사용자 공개용인지, 내부 관리용인지”
> 
- **0 = External (외부 주소)**
    
    → 사용자가 입금을 받을 때 사용하는 주소 (UI에서 보이는 일반 주소)
    
- **1 = Internal (내부 주소)**
    
    → 지갑 내부에서 change(거스름돈)를 받는 주소
    

### **Address Index (주소 인덱스)**

> “한 계정 내에서 몇 번째 주소인지”
> 
- 하나의 Account 안에서도 무한히 많은 주소를 생성 가능
- 예를 들어,
    - m/44'/60'/0'/0/0 → 첫 번째 주소
    - m/44'/60'/0'/0/1 → 두 번째 주소
    - m/44'/60'/0'/0/2 → 세 번째 주소

위에서 언급한 비트코인 지갑에서는 원칙적으로 거래마다 새 주소를 발급해 개인정보를 보호하는데, 그게 바로 **Address Index를 증가시키는 방식**으로 구현된다

---

### **하드닝(Hardened Derivation)과 보안**

- 각 경로 뒤의 '(apostrophe)는 **Hardened Derivation**을 의미
- 이 표시는 해당 레벨에서 자식 키를 파생하기 위해 반드시 **부모 비밀키**가 필요함을 뜻함
- 즉, 공개키(xpub)만으로는 자식 키를 계산할 수 없음
- Hardened 레벨에서는 공개키(xpub)만으로 자식 키를 계산할 수 없기 때문에, 상위 레벨이 노출되어도 하위 비밀키를 역산할 수 없음
- 보통 아래 형태를 사용함
    - purpose', coin_type', account' 까지는 Hardened
    - change, address_index 는 Non-Hardened

→  이렇게 하면 계정 단위(xpub)를 공개해도 하위 주소만 볼 수 있고, 비밀키가 노출되지는 않는다.

<aside>
💡

### **xpub / xprv의 개념**

- HDWallet은 BIP32 표준에 따라 하나의 “확장 키(Extended Key)”를 두 가지 형태로 관리
    - **xprv**: 확장 개인키 (extended private key)
    - **xpub**: 확장 공개키 (extended public key)

### **xpub의 활용: 보기 전용(View-only) 지갑**

xpub은 공개키 파생만 가능하므로, 비밀키가 없는 상태에서도 다음이 가능함

- 새 주소 생성
- 해당 주소의 잔액, 거래 내역 조회

하지만 **송금(서명)** 은 불가능! → 서명을 하려면 비밀키(xprv)가 반드시 필요하기 때문

</aside>
